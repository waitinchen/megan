# ğŸš‚ Railway Builder åˆ‡æ›å¼·åˆ¶æ¸…é™¤ Cache æŒ‡å—

## ğŸ“‹ ä»»å‹™ç›®æ¨™

å¼·åˆ¶æ¸…é™¤ Railway çš„æ§‹å»ºç·©å­˜ï¼Œè§£æ±º `this.context.cookies(...).get is not a function` éŒ¯èª¤ã€‚

---

## ğŸ› ï¸ æ“ä½œæ­¥é©Ÿï¼ˆåš´æ ¼æŒ‰ç…§é †åºåŸ·è¡Œï¼‰

### **Step A â€” ç¬¬ä¸€æ¬¡åˆ‡æ›ï¼ˆåˆ‡æ›åˆ° Dockerfileï¼‰**

1. **ç™»å…¥ Railway Dashboard**
   - è¨ªå•ï¼šhttps://railway.app
   - é¸æ“‡é …ç›®ï¼š`megan`

2. **é€²å…¥ Settings**
   - é»æ“Šå·¦å´é¸å–®çš„ **Settings**
   - æˆ–ç›´æ¥è¨ªå•ï¼š`https://railway.app/project/[your-project-id]/settings`

3. **æ‰¾åˆ° Build è¨­å®š**
   - åœ¨ Settings é é¢ä¸­æ‰¾åˆ° **Build** å€å¡Š
   - æˆ–ç›´æ¥è¨ªå•ï¼š`https://railway.app/project/[your-project-id]/settings/build`

4. **åˆ‡æ› Builder**
   - æ‰¾åˆ° **Builder** é¸é …
   - ç›®å‰æ‡‰è©²æ˜¯ï¼š`Railpack (Default)`
   - **æ”¹ç‚º**ï¼š`Dockerfile`
   - é»æ“Š **Save** æˆ– **Update**

5. **ç­‰å¾…ç¬¬ä¸€æ¬¡éƒ¨ç½²å®Œæˆ**
   - Railway æœƒè‡ªå‹•è§¸ç™¼æ–°çš„éƒ¨ç½²
   - é€²å…¥ **Deployments** æ¨™ç±¤é 
   - ç­‰å¾…ç‹€æ…‹å¾ "Building" â†’ "Deploying" â†’ "Active"
   - **é‡è¦**ï¼šå¿…é ˆç­‰åˆ°éƒ¨ç½²å®Œå…¨å®Œæˆï¼ˆé¡¯ç¤ºç¶ è‰²å‹¾å‹¾ âœ…ï¼‰

---

### **Step B â€” ç¬¬äºŒæ¬¡åˆ‡å›ï¼ˆåˆ‡å› Railpackï¼‰**

1. **å†æ¬¡é€²å…¥ Build è¨­å®š**
   - Settings â†’ Build

2. **åˆ‡æ›å› Railpack**
   - å°‡ Builder å¾ `Dockerfile` **æ”¹å›**ï¼š`Railpack (Default)`
   - é»æ“Š **Save**

3. **ç­‰å¾…ç¬¬äºŒæ¬¡éƒ¨ç½²å®Œæˆ**
   - Railway æœƒå†æ¬¡è§¸ç™¼éƒ¨ç½²
   - é€²å…¥ **Deployments** æ¨™ç±¤é 
   - ç­‰å¾…éƒ¨ç½²å®Œå…¨å®Œæˆ
   - **é€™ä¸€æ­¥æœ€é‡è¦**ï¼šç¢ºä¿ç¬¬äºŒæ¬¡éƒ¨ç½²ä¹Ÿå®Œå…¨å®Œæˆ

---

## ğŸ” é©—è­‰æ­¥é©Ÿ

### 1. æª¢æŸ¥éƒ¨ç½²æ—¥èªŒ

åœ¨ Railway Dashboard ä¸­ï¼š

1. é€²å…¥ **Deployments** æ¨™ç±¤
2. é»æ“Šæœ€æ–°çš„éƒ¨ç½²ï¼ˆæ‡‰è©²æœ‰å…©æ¬¡ï¼šä¸€æ¬¡ Dockerfileï¼Œä¸€æ¬¡ Railpackï¼‰
3. æŸ¥çœ‹ **Build Logs** å’Œ **Deploy Logs**

**éœ€è¦ç¢ºèªçš„å…§å®¹**ï¼š
- âœ… Build éç¨‹ä¸­æ²’æœ‰ä½¿ç”¨èˆŠçš„ cache
- âœ… çœ‹åˆ° "Installing dependencies" æˆ–é¡ä¼¼çš„æ–°å®‰è£è¨Šæ¯
- âœ… æ²’æœ‰çœ‹åˆ° "Using cache" ç›¸é—œçš„èˆŠç·©å­˜è¨Šæ¯

### 2. æª¢æŸ¥ Runtime æ—¥èªŒ

1. åœ¨éƒ¨ç½²å®Œæˆå¾Œï¼Œé€²å…¥ **Deployments** â†’ æœ€æ–°éƒ¨ç½²
2. æŸ¥çœ‹ **Runtime Logs**ï¼ˆ"Starting container" ä¹‹å¾Œçš„æ—¥èªŒï¼‰

**éœ€è¦ç¢ºèªçš„å…§å®¹**ï¼š
- âœ… æ²’æœ‰ `this.context.cookies(...).get is not a function` éŒ¯èª¤
- âœ… æ‡‰ç”¨æ­£å¸¸å•Ÿå‹•
- âœ… æ²’æœ‰ cookies ç›¸é—œçš„éŒ¯èª¤

### 3. æ¸¬è©¦ç”Ÿç”¢ç’°å¢ƒ API

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¸¬è©¦ï¼ˆæˆ–ä½¿ç”¨ç€è¦½å™¨ï¼‰ï¼š

```bash
# æ¸¬è©¦ Favorites API
curl -X GET https://megan.tonetown.ai/api/favorites \
  -H "Cookie: your-session-cookie" \
  -v

# æ¸¬è©¦ Conversations API
curl -X GET https://megan.tonetown.ai/api/conversations \
  -H "Cookie: your-session-cookie" \
  -v
```

**é æœŸçµæœ**ï¼š
- âœ… å¦‚æœå·²ç™»éŒ„ï¼šè¿”å› 200 OK å’Œæ•¸æ“š
- âœ… å¦‚æœæœªç™»éŒ„ï¼šè¿”å› 401 Unauthorizedï¼ˆé€™æ˜¯æ­£å¸¸çš„ï¼‰
- âŒ **ä¸æ‡‰è©²**è¿”å› 500 Internal Server Error å’Œ cookies éŒ¯èª¤

### 4. ä½¿ç”¨é©—è­‰è…³æœ¬

é‹è¡Œæä¾›çš„é©—è­‰è…³æœ¬ï¼š

```bash
node verify-production-fix.js
```

---

## ğŸ“ éœ€è¦è¨˜éŒ„çš„è³‡è¨Šï¼ˆå®Œæˆå¾Œæä¾›ï¼‰

å®Œæˆå…©æ¬¡éƒ¨ç½²å¾Œï¼Œè«‹æä¾›ä»¥ä¸‹è³‡è¨Šï¼š

### ç¬¬ä¸€æ¬¡éƒ¨ç½²ï¼ˆDockerfileï¼‰

```
[ç¬¬ä¸€æ¬¡éƒ¨ç½²]
- éƒ¨ç½² ID: ___________
- éƒ¨ç½²æ™‚é–“: ___________
- Build Logs æ‘˜è¦: 
  [è²¼ä¸Šé—œéµçš„ build logsï¼Œç‰¹åˆ¥æ˜¯é—œæ–¼ cache çš„éƒ¨åˆ†]

- Runtime Logs æ‘˜è¦:
  [è²¼ä¸Š "Starting container" ä¹‹å¾Œçš„é—œéµ logs]
```

### ç¬¬äºŒæ¬¡éƒ¨ç½²ï¼ˆRailpackï¼‰

```
[ç¬¬äºŒæ¬¡éƒ¨ç½²]
- éƒ¨ç½² ID: ___________
- éƒ¨ç½²æ™‚é–“: ___________
- Build Logs æ‘˜è¦:
  [è²¼ä¸Šé—œéµçš„ build logs]

- Runtime Logs æ‘˜è¦:
  [è²¼ä¸Šé—œéµçš„ runtime logs]
```

### é©—è­‰çµæœ

```
[é©—è­‰çµæœ]
- API æ¸¬è©¦çµæœ: 
  - GET /api/favorites: [ç‹€æ…‹ç¢¼] - [çµæœ]
  - GET /api/conversations: [ç‹€æ…‹ç¢¼] - [çµæœ]
  
- éŒ¯èª¤æª¢æŸ¥:
  - cookies éŒ¯èª¤: [å·²æ¶ˆå¤± / ä»ç„¶å­˜åœ¨]
  - å…¶ä»–éŒ¯èª¤: [åˆ—å‡ºä»»ä½•å…¶ä»–éŒ¯èª¤]
```

---

## âœ… æˆåŠŸæ¨™æº–

ä¿®å¾©æˆåŠŸå¾Œï¼Œæ‡‰è©²ï¼š

1. âœ… **ä¸å†å‡ºç¾** `this.context.cookies(...).get is not a function` éŒ¯èª¤
2. âœ… API è¿”å›æ­£ç¢ºçš„ç‹€æ…‹ç¢¼ï¼ˆ200 æˆ– 401ï¼Œè€Œä¸æ˜¯ 500ï¼‰
3. âœ… æ‡‰ç”¨æ­£å¸¸é‹è¡Œï¼Œæ²’æœ‰ cookies ç›¸é—œéŒ¯èª¤
4. âœ… Runtime logs ä¸­æ²’æœ‰ cookies éŒ¯èª¤

---

## ğŸš¨ å¦‚æœå•é¡Œä»ç„¶å­˜åœ¨

å¦‚æœåŸ·è¡Œå®Œå…©æ¬¡åˆ‡æ›å¾Œï¼Œå•é¡Œä»ç„¶å­˜åœ¨ï¼š

1. **æª¢æŸ¥ä»£ç¢¼æ˜¯å¦å·²æ¨é€**
   ```bash
   git status
   git log --oneline -5
   ```

2. **ç¢ºèªç’°å¢ƒè®Šæ•¸**
   - Railway Settings â†’ Variables
   - ç¢ºèªæ‰€æœ‰å¿…éœ€çš„ç’°å¢ƒè®Šæ•¸éƒ½å·²è¨­ç½®

3. **å˜—è©¦å®Œå…¨åˆªé™¤æœå‹™ä¸¦é‡æ–°å‰µå»º**
   - é€™æ˜¯æœ€å¾Œçš„æ‰‹æ®µ
   - ç¢ºä¿å…ˆå‚™ä»½æ‰€æœ‰é…ç½®

---

## ğŸ“ éœ€è¦å¹«åŠ©æ™‚

å¦‚æœé‡åˆ°å•é¡Œï¼Œè«‹æä¾›ï¼š
1. Railway Dashboard çš„æˆªåœ–
2. å®Œæ•´çš„ Build Logs
3. å®Œæ•´çš„ Runtime Logs
4. ç€è¦½å™¨æ§åˆ¶å°çš„éŒ¯èª¤è¨Šæ¯

---

**æœ€å¾Œæ›´æ–°**: 2024-12-19
**ç‹€æ…‹**: å¾…åŸ·è¡Œ






