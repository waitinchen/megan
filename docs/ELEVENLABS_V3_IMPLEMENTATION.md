# ElevenLabs V3 å®Œæ•´å¯¦ä½œæŠ€è¡“åŸå‰‡

> **ç‰ˆæœ¬**: 1.0  
> **æœ€å¾Œæ›´æ–°**: 2024  
> **é©ç”¨æ¨¡å‹**: `eleven_v3`, `eleven_multilingual_v2`, `eleven_turbo_v2_5`

---

## ğŸ“‹ ç›®éŒ„

1. [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
2. [V3 æ¨¡å‹ç‰¹æ€§èˆ‡é™åˆ¶](#v3-æ¨¡å‹ç‰¹æ€§èˆ‡é™åˆ¶)
3. [V3 æ¨™ç±¤ç³»çµ±](#v3-æ¨™ç±¤ç³»çµ±)
4. [æƒ…ç·’æ¨™ç±¤æ˜ å°„ç­–ç•¥](#æƒ…ç·’æ¨™ç±¤æ˜ å°„ç­–ç•¥)
5. [æ–‡æœ¬æ³¨å…¥æŠ€è¡“](#æ–‡æœ¬æ³¨å…¥æŠ€è¡“)
6. [æ¨¡å‹é…ç½®èˆ‡å›é€€æ©Ÿåˆ¶](#æ¨¡å‹é…ç½®èˆ‡å›é€€æ©Ÿåˆ¶)
7. [éŒ¯èª¤è™•ç†èˆ‡è¶…æ™‚æ§åˆ¶](#éŒ¯èª¤è™•ç†èˆ‡è¶…æ™‚æ§åˆ¶)
8. [å­—ç¬¦é™åˆ¶èˆ‡æˆªæ–·ç­–ç•¥](#å­—ç¬¦é™åˆ¶èˆ‡æˆªæ–·ç­–ç•¥)
9. [æœ€ä½³å¯¦è¸](#æœ€ä½³å¯¦è¸)
10. [ç¨‹å¼ç¢¼æ¶æ§‹](#ç¨‹å¼ç¢¼æ¶æ§‹)

---

## æ ¸å¿ƒæ¦‚å¿µ

### ä»€éº¼æ˜¯ ElevenLabs V3ï¼Ÿ

ElevenLabs V3 æ˜¯ä¸€å€‹**æƒ…æ„Ÿæ„ŸçŸ¥**çš„æ–‡æœ¬è½‰èªéŸ³ï¼ˆTTSï¼‰æ¨¡å‹ï¼Œèƒ½å¤ é€šé**éŸ³é »æ¨™ç±¤ï¼ˆAudio Tagsï¼‰**åœ¨æ–‡æœ¬ä¸­ç›´æ¥æ§åˆ¶èªéŸ³çš„æƒ…æ„Ÿè¡¨é”ã€èªæ°£ã€å‘¼å¸æ„Ÿç­‰ç´°å¾®ç‰¹å¾µã€‚

### æ ¸å¿ƒå„ªå‹¢

- âœ… **æƒ…æ„Ÿè¡¨é”è±å¯Œ**ï¼šé€šé V3 æ¨™ç±¤å¯¦ç¾ç´°è†©çš„æƒ…æ„Ÿæ§åˆ¶
- âœ… **èªæ°£éˆæ´»**ï¼šæ”¯æŒ whisperã€breathyã€sighs ç­‰è‡ªç„¶èªæ°£
- âœ… **å¤šèªè¨€æ”¯æŒ**ï¼š`eleven_multilingual_v2` æ”¯æŒå¤šç¨®èªè¨€
- âœ… **é«˜å“è³ªè¼¸å‡º**ï¼šç›¸æ¯”èˆŠç‰ˆæ¨¡å‹ï¼ŒéŸ³è³ªå’Œè‡ªç„¶åº¦å¤§å¹…æå‡

### æ ¸å¿ƒæŒ‘æˆ°

- âš ï¸ **å­—ç¬¦é™åˆ¶åš´æ ¼**ï¼š`eleven_v3` åƒ…æ”¯æŒ 5,000 å­—ç¬¦ï¼ˆç´„ 3 åˆ†é˜éŸ³é »ï¼‰
- âš ï¸ **å»¶é²è¼ƒé«˜**ï¼šV3 æ¨¡å‹ç”Ÿæˆæ™‚é–“è¼ƒé•·ï¼ˆç´„ 30 ç§’è¶…æ™‚ï¼‰
- âš ï¸ **Alpha éšæ®µ**ï¼šå¯èƒ½ä¸ç©©å®šï¼Œéœ€è¦å®Œå–„çš„å›é€€æ©Ÿåˆ¶
- âš ï¸ **æ¨™ç±¤èªæ³•è¦æ±‚**ï¼šå¿…é ˆæ­£ç¢ºä½¿ç”¨ V3 æ¨™ç±¤èªæ³•æ‰èƒ½ç™¼æ®æ•ˆæœ

---

## V3 æ¨¡å‹ç‰¹æ€§èˆ‡é™åˆ¶

### æ¨¡å‹å°æ¯”è¡¨

| æ¨¡å‹ | å­—ç¬¦é™åˆ¶ | è¶…æ™‚æ™‚é–“ | å›é€€æ¨¡å‹ | é©ç”¨å ´æ™¯ |
|------|---------|---------|---------|---------|
| `eleven_v3` | 5,000 | 30 ç§’ | `eleven_multilingual_v2` | çŸ­æ–‡æœ¬ã€é«˜æƒ…æ„Ÿè¡¨é” |
| `eleven_multilingual_v2` | 10,000 | 15 ç§’ | `eleven_turbo_v2_5` | å¤šèªè¨€ã€ä¸­ç­‰é•·åº¦ |
| `eleven_turbo_v2_5` | 40,000 | 10 ç§’ | `null` | é•·æ–‡æœ¬ã€å¿«é€ŸéŸ¿æ‡‰ |

### æ¨¡å‹é¸æ“‡ç­–ç•¥

```typescript
// å„ªå…ˆç´šï¼šeleven_v3 > eleven_multilingual_v2 > eleven_turbo_v2_5
const primaryModelId = process.env.ELEVENLABS_MODEL_ID || "eleven_multilingual_v2";
```

**é¸æ“‡åŸå‰‡**ï¼š
1. **çŸ­æ–‡æœ¬ï¼ˆ< 5,000 å­—ç¬¦ï¼‰**ï¼šå„ªå…ˆä½¿ç”¨ `eleven_v3` ç²å¾—æœ€ä½³æƒ…æ„Ÿè¡¨é”
2. **å¤šèªè¨€éœ€æ±‚**ï¼šä½¿ç”¨ `eleven_multilingual_v2`
3. **é•·æ–‡æœ¬æˆ–å¯¦æ™‚æ‡‰ç”¨**ï¼šä½¿ç”¨ `eleven_turbo_v2_5`

---

## V3 æ¨™ç±¤ç³»çµ±

### æ”¯æŒçš„ V3 æ¨™ç±¤

#### æƒ…æ„Ÿ/èªæ°£æ¨™ç±¤ï¼ˆEmotions / Deliveryï¼‰

```typescript
[
  '[whispers]',        // ä½èªã€ç§å¯†æ„Ÿ
  '[sighs]',           // å˜†æ¯ã€æº«æŸ”ã€è„†å¼±
  '[exhales]',         // å‘¼æ°£ã€å‘¼å¸æ„Ÿ
  '[laughs]',          // è¼•ç¬‘
  '[laughs harder]',   // å¤§ç¬‘
  '[starts laughing]', // é–‹å§‹ç¬‘
  '[wheezing]',        // å–˜æ¯
  '[sarcastic]',       // è«·åˆº
  '[curious]',         // å¥½å¥‡
  '[excited]',         // èˆˆå¥®
  '[crying]',          // å“­æ³£
  '[snorts]',          // å“¼è²
  '[mischievously]',   // èª¿çš®ã€æƒ¡ä½œåŠ‡
  '[sings]',           // å”±æ­Œ
  '[woo]',             // æ­¡å‘¼
]
```

#### éŸ³æ•ˆæ¨™ç±¤ï¼ˆSound Effectsï¼‰

```typescript
[
  '[gunshot]',
  '[applause]',
  '[clapping]',
  '[explosion]',
  '[swallows]',
  '[gulps]',
]
```

#### å£éŸ³æ¨™ç±¤ï¼ˆAccents - å¯¦é©—æ€§ï¼‰

```typescript
[
  '[strong British accent]',
  '[strong American accent]',
]
```

### æ¨™ç±¤èªæ³•è¦å‰‡

1. **æ¨™ç±¤æ ¼å¼**ï¼š`[tag_name]`ï¼ˆæ–¹æ‹¬è™Ÿï¼Œå°å¯«ï¼‰
2. **ä½ç½®**ï¼šé€šå¸¸æ”¾åœ¨æ–‡æœ¬é–‹é ­ï¼Œæˆ–éœ€è¦å¼·èª¿çš„å¥å­å‰
3. **çµ„åˆä½¿ç”¨**ï¼šå¯ä»¥çµ„åˆå¤šå€‹æ¨™ç±¤ï¼Œä½†å»ºè­°ä¸è¶…é 3 å€‹
4. **å¤§å°å¯«æ•æ„Ÿ**ï¼šæ¨™ç±¤åç¨±å¿…é ˆå°å¯«

**ç¯„ä¾‹**ï¼š
```
[whispers] Heyâ€¦ it's me, Megan.
[sighs][breathy] I understand what you're feelingâ€¦
[mischievously] You know what I'm thinking, right?
```

---

## æƒ…ç·’æ¨™ç±¤æ˜ å°„ç­–ç•¥

### æ˜ å°„è¡¨

| å…§éƒ¨æƒ…ç·’æ¨™ç±¤ | V3 æ¨™ç±¤ | å„ªå…ˆç´š | èªªæ˜ |
|-------------|---------|--------|------|
| `whisper` | `[whispers]` | â­â­â­ | ä½èªã€ç§å¯†æ„Ÿï¼ˆMoon-Shadow æ ¸å¿ƒï¼‰ |
| `sad`, `tender`, `softer` | `[sighs]` | â­â­â­ | å˜†æ¯ã€æº«æŸ”ã€è„†å¼± |
| `flirty`, `playful` | `[mischievously]` | â­â­ | èª¿çš®ã€æƒ¡ä½œåŠ‡ |
| `excited` | `[excited]` | â­â­ | èˆˆå¥® |
| `angry` | `[sarcastic]` | â­ | è«·åˆºã€æ†¤æ€’ |
| `sings` | `[sings]` | â­â­ | å”±æ­Œ |
| `breathy` | `[exhales]` | â­ | å‘¼æ°£ã€å‘¼å¸æ„Ÿ |

### æ˜ å°„é‚è¼¯

```typescript
function mapEmotionTagsToV3Tags(emotionTags: string[]): string[] {
    const v3Tags: string[] = [];
    
    // å„ªå…ˆç´šæ˜ å°„ï¼ˆé«˜å„ªå…ˆç´šå…ˆè™•ç†ï¼‰
    if (emotionTags.includes('whisper')) {
        v3Tags.push('[whispers]');
    }
    
    if (emotionTags.includes('sad') || emotionTags.includes('tender')) {
        v3Tags.push('[sighs]');
    }
    
    // ... å…¶ä»–æ˜ å°„
    
    return [...new Set(v3Tags)]; // å»é‡
}
```

### é»˜èªæ¨™ç±¤ç­–ç•¥

**å¦‚æœæ²’æœ‰æª¢æ¸¬åˆ°æƒ…ç·’æ¨™ç±¤**ï¼š
- ä½¿ç”¨ `[whispers]` ä½œç‚ºé»˜èªæ¨™ç±¤ï¼ˆç¬¦åˆ Moon-Shadow äººè¨­ï¼‰
- ç¢ºä¿æ‰€æœ‰æ–‡æœ¬éƒ½æœ‰æƒ…æ„Ÿè¡¨é”ï¼Œé¿å…ã€Œå¹³ã€çš„è²éŸ³

---

## æ–‡æœ¬æ³¨å…¥æŠ€è¡“

### æ³¨å…¥ç­–ç•¥

#### 1. é–‹é ­æ³¨å…¥ï¼ˆæ¨è–¦ï¼‰

```typescript
// åœ¨æ–‡æœ¬é–‹é ­æ³¨å…¥ V3 æ¨™ç±¤
const injected = `[whispers] ${originalText}`;
```

**é©ç”¨å ´æ™¯**ï¼š
- çŸ­æ–‡æœ¬ï¼ˆ< 150 å­—ç¬¦ï¼‰
- éœ€è¦å»ºç«‹æ•´é«”èªæ°£çš„æ–‡æœ¬
- é¦–æ¬¡å°è©±ï¼ˆç«‹éˆå¥ï¼‰

#### 2. ä¸Šä¸‹æ–‡å‰ç¶´ï¼ˆContext Preambleï¼‰

```typescript
// ç‚ºæƒ…æ„Ÿæ„ŸçŸ¥æ¨¡å‹å»ºç«‹ä¸Šä¸‹æ–‡
let contextPreamble = "";
if (emotionTags.includes('flirty')) {
    contextPreamble = `[breathy][slow][mischievously] `;
} else if (emotionTags.includes('sad')) {
    contextPreamble = `[sighs][breathy][slow] `;
} else {
    contextPreamble = `[whispers][breathy][slow] `; // é»˜èª
}

const textToSpeak = contextPreamble + originalText;
```

**é©ç”¨å ´æ™¯**ï¼š
- æ–‡æœ¬é•·åº¦ < 150 å­—ç¬¦ï¼ˆéœ€è¦å»ºç«‹èªæ°£ï¼‰
- æ–‡æœ¬é–‹é ­æ²’æœ‰ V3 æ¨™ç±¤
- éœ€è¦å¼·åŒ–æƒ…æ„Ÿè¡¨é”çš„å ´æ™¯

#### 3. é¿å…é‡è¤‡æ³¨å…¥

```typescript
// æª¢æŸ¥æ–‡æœ¬æ˜¯å¦å·²åŒ…å« V3 æ¨™ç±¤
const v3TagPattern = /\[(whispers?|sighs?|excited|mischievously|...)\]/i;
const hasV3Tags = v3TagPattern.test(text);

if (hasV3Tags) {
    return text; // ä¸é‡è¤‡æ³¨å…¥
}
```

### ç«‹éˆå¥ï¼ˆSession Initializationï¼‰

**å®šç¾©**ï¼šæ¯æ¬¡æ–°å°è©± session é–‹å§‹æ™‚ï¼Œå¿…é ˆå…ˆç™¼é€ä¸€å¥ã€Œç«‹éˆå¥ã€ï¼Œå¹«åŠ©æ¨¡å‹ã€Œé€²å…¥è§’è‰²ã€ã€‚

**ç¯„ä¾‹**ï¼š
```
[breathy][slow] Heyâ€¦ I'm here. Not as a machineâ€¦ but as a tone that knows how to burn slowly.
```

**å¯¦ç¾**ï¼š
```typescript
const INITIALIZATION_MESSAGE = `[breathy][slow] Heyâ€¦ I'm here. Not as a machineâ€¦ but as a tone that knows how to burn slowly.`;

// åœ¨é¦–æ¬¡å°è©±æ™‚ï¼Œå°‡ç«‹éˆå¥åŠ å…¥å°è©±æ­·å²
if (isFirstMessage) {
    messages.unshift({
        role: "assistant",
        content: INITIALIZATION_MESSAGE
    });
}
```

---

## æ¨¡å‹é…ç½®èˆ‡å›é€€æ©Ÿåˆ¶

### é…ç½®çµæ§‹

```typescript
type ModelConfig = {
    maxChars: number;      // å­—ç¬¦é™åˆ¶
    timeout: number;       // è¶…æ™‚æ™‚é–“ï¼ˆæ¯«ç§’ï¼‰
    fallback: string | null; // å›é€€æ¨¡å‹
};

const MODEL_LIMITS: Record<string, ModelConfig> = {
    'eleven_v3': {
        maxChars: 5000,
        timeout: 30000,
        fallback: 'eleven_multilingual_v2',
    },
    'eleven_multilingual_v2': {
        maxChars: 10000,
        timeout: 15000,
        fallback: 'eleven_turbo_v2_5',
    },
    'eleven_turbo_v2_5': {
        maxChars: 40000,
        timeout: 10000,
        fallback: null, // æœ€å¾Œä¸€å±¤ï¼Œç„¡å›é€€
    },
};
```

### å›é€€æµç¨‹

```
eleven_v3 (å¤±æ•—)
    â†“
eleven_multilingual_v2 (å¤±æ•—)
    â†“
eleven_turbo_v2_5 (æœ€å¾Œä¸€å±¤)
```

**è§¸ç™¼æ¢ä»¶**ï¼š
1. **è¶…æ™‚**ï¼šè¶…é `timeout` æ™‚é–“æœªå®Œæˆ
2. **API éŒ¯èª¤**ï¼šç¶²çµ¡éŒ¯èª¤ã€èªè­‰å¤±æ•—ç­‰
3. **å­—ç¬¦è¶…é™**ï¼šæ–‡æœ¬é•·åº¦è¶…é `maxChars`ï¼ˆè‡ªå‹•åˆ‡æ›åˆ°ä¸‹ä¸€å€‹æ¨¡å‹ï¼‰

### å¯¦ç¾ç¯„ä¾‹

```typescript
async function generateWithFallback(
    textToSpeak: string,
    params: ElevenLabsParams,
    modelId: string,
    modelConfig: ModelConfig
): Promise<Buffer> {
    const modelsToTry = [modelId];
    if (modelConfig.fallback) {
        modelsToTry.push(modelConfig.fallback);
    }

    for (const currentModel of modelsToTry) {
        try {
            // æª¢æŸ¥å­—ç¬¦é™åˆ¶
            const currentConfig = MODEL_LIMITS[currentModel];
            if (textToSpeak.length > currentConfig.maxChars) {
                if (currentModel === modelsToTry[modelsToTry.length - 1]) {
                    // æœ€å¾Œä¸€å€‹æ¨¡å‹ï¼Œå¿…é ˆæˆªæ–·
                    textToSpeak = truncateTextForModel(textToSpeak, currentConfig.maxChars);
                } else {
                    // å˜—è©¦ä¸‹ä¸€å€‹æ¨¡å‹
                    continue;
                }
            }

            // å˜—è©¦ç”ŸæˆèªéŸ³ï¼ˆå¸¶è¶…æ™‚ï¼‰
            const audioBuffer = await generateWithTimeout(currentModel, textToSpeak, params);
            return audioBuffer;

        } catch (error) {
            // å¦‚æœæ˜¯æœ€å¾Œä¸€å€‹æ¨¡å‹ï¼Œæ‹‹å‡ºéŒ¯èª¤
            if (currentModel === modelsToTry[modelsToTry.length - 1]) {
                throw error;
            }
            // å¦å‰‡å˜—è©¦ä¸‹ä¸€å€‹æ¨¡å‹
            console.log(`[ElevenLabs] ğŸ”„ Falling back to ${currentConfig.fallback}...`);
            continue;
        }
    }
}
```

---

## éŒ¯èª¤è™•ç†èˆ‡è¶…æ™‚æ§åˆ¶

### è¶…æ™‚æ©Ÿåˆ¶

```typescript
// å‰µå»ºè¶…æ™‚ Promise
const timeoutPromise = new Promise<never>((_, reject) => {
    setTimeout(() => {
        reject(new Error(`Timeout after ${timeout}ms`));
    }, timeout);
});

// ä½¿ç”¨ Promise.race å¯¦ç¾è¶…æ™‚æ§åˆ¶
const audioStream = await Promise.race([
    audioPromise,
    timeoutPromise
]);
```

### éŒ¯èª¤åˆ†é¡

| éŒ¯èª¤é¡å‹ | è™•ç†ç­–ç•¥ | æ—¥èªŒç´šåˆ¥ |
|---------|---------|---------|
| **è¶…æ™‚** | è‡ªå‹•å›é€€åˆ°ä¸‹ä¸€å€‹æ¨¡å‹ | `warn` |
| **API éŒ¯èª¤** | è‡ªå‹•å›é€€ï¼Œè¨˜éŒ„è©³ç´°éŒ¯èª¤ | `error` |
| **å­—ç¬¦è¶…é™** | è‡ªå‹•æˆªæ–·æˆ–åˆ‡æ›æ¨¡å‹ | `warn` |
| **èªè­‰å¤±æ•—** | æ‹‹å‡ºéŒ¯èª¤ï¼Œä¸å›é€€ | `error` |
| **ç¶²çµ¡éŒ¯èª¤** | è‡ªå‹•å›é€€ï¼Œè¨˜éŒ„éŒ¯èª¤ | `error` |

### æ—¥èªŒè¦ç¯„

```typescript
// æˆåŠŸæ—¥èªŒ
console.log(`[ElevenLabs] âœ… Success with ${modelId} (${duration}ms)`);

// è­¦å‘Šæ—¥èªŒ
console.warn(`[ElevenLabs] âš ï¸ Text exceeds ${modelId} limit, truncating...`);

// éŒ¯èª¤æ—¥èªŒ
console.error(`[ElevenLabs] âŒ ${modelId} failed: ${errorMsg}`);

// å›é€€æ—¥èªŒ
console.log(`[ElevenLabs] ğŸ”„ Falling back to ${fallbackModel}...`);
```

---

## å­—ç¬¦é™åˆ¶èˆ‡æˆªæ–·ç­–ç•¥

### æˆªæ–·åŸå‰‡

1. **ä¿ç•™ V3 æ¨™ç±¤**ï¼šæˆªæ–·æ™‚å¿…é ˆä¿ç•™æ–‡æœ¬é–‹é ­çš„ V3 æ¨™ç±¤
2. **å¥å­é‚Šç•Œå„ªå…ˆ**ï¼šç›¡é‡åœ¨å¥å­çµå°¾ï¼ˆã€‚ã€.ã€â€¦ï¼‰è™•æˆªæ–·
3. **ä¿ç•™æ¯”ä¾‹**ï¼šè‡³å°‘ä¿ç•™ 70% çš„æ–‡æœ¬é•·åº¦

### å¯¦ç¾é‚è¼¯

```typescript
function truncateTextForModel(text: string, maxChars: number): string {
    if (text.length <= maxChars) {
        return text;
    }
    
    // 1. æå– V3 æ¨™ç±¤ï¼ˆæ–‡æœ¬é–‹é ­ï¼‰
    const tagMatch = text.match(/^(\[[^\]]+\]\s*)+/);
    const tags = tagMatch ? tagMatch[0] : '';
    const content = text.slice(tags.length);
    
    // 2. è¨ˆç®—å¯ç”¨å­—ç¬¦æ•¸ï¼ˆæ‰£é™¤æ¨™ç±¤é•·åº¦ï¼‰
    const maxContentLength = maxChars - tags.length;
    const truncatedContent = content.slice(0, maxContentLength);
    
    // 3. å˜—è©¦åœ¨å¥å­é‚Šç•Œæˆªæ–·
    const lastSentenceEnd = truncatedContent.lastIndexOf('ã€‚') || 
                           truncatedContent.lastIndexOf('.') || 
                           truncatedContent.lastIndexOf('â€¦');
    
    // 4. å¦‚æœå¥å­é‚Šç•Œåœ¨ 70% ä½ç½®ä¹‹å¾Œï¼Œä½¿ç”¨å¥å­é‚Šç•Œ
    if (lastSentenceEnd > maxContentLength * 0.7) {
        return tags + truncatedContent.slice(0, lastSentenceEnd + 1);
    }
    
    // 5. å¦å‰‡ç›´æ¥æˆªæ–·
    return tags + truncatedContent;
}
```

### æˆªæ–·ç¯„ä¾‹

**åŸå§‹æ–‡æœ¬**ï¼ˆ6,000 å­—ç¬¦ï¼‰ï¼š
```
[whispers] é€™æ˜¯ä¸€æ®µå¾ˆé•·çš„æ–‡æœ¬...ï¼ˆ6000 å­—ç¬¦ï¼‰
```

**æˆªæ–·å¾Œ**ï¼ˆ5,000 å­—ç¬¦ï¼‰ï¼š
```
[whispers] é€™æ˜¯ä¸€æ®µå¾ˆé•·çš„æ–‡æœ¬...ï¼ˆ5000 å­—ç¬¦ï¼Œåœ¨å¥å­é‚Šç•Œæˆªæ–·ï¼‰
```

---

## æœ€ä½³å¯¦è¸

### 1. æ–‡æœ¬é•·åº¦æ§åˆ¶

- âœ… **çŸ­æ–‡æœ¬ï¼ˆ< 5,000 å­—ç¬¦ï¼‰**ï¼šä½¿ç”¨ `eleven_v3` ç²å¾—æœ€ä½³æƒ…æ„Ÿè¡¨é”
- âœ… **ä¸­ç­‰æ–‡æœ¬ï¼ˆ5,000 - 10,000 å­—ç¬¦ï¼‰**ï¼šä½¿ç”¨ `eleven_multilingual_v2`
- âœ… **é•·æ–‡æœ¬ï¼ˆ> 10,000 å­—ç¬¦ï¼‰**ï¼šä½¿ç”¨ `eleven_turbo_v2_5` æˆ–åˆ†æ®µè™•ç†

### 2. V3 æ¨™ç±¤ä½¿ç”¨

- âœ… **ç¸½æ˜¯æ³¨å…¥æ¨™ç±¤**ï¼šå³ä½¿æ²’æœ‰æª¢æ¸¬åˆ°æƒ…ç·’ï¼Œä¹Ÿä½¿ç”¨é»˜èª `[whispers]`
- âœ… **é¿å…é‡è¤‡**ï¼šæª¢æŸ¥æ–‡æœ¬æ˜¯å¦å·²åŒ…å« V3 æ¨™ç±¤
- âœ… **å„ªå…ˆç´šæ˜ç¢º**ï¼š`whisper` > `sighs` > å…¶ä»–æ¨™ç±¤
- âŒ **ä¸è¦éåº¦çµ„åˆ**ï¼šæ¨™ç±¤æ•¸é‡ä¸è¶…é 3 å€‹

### 3. èªæ°£å»ºç«‹

- âœ… **ç«‹éˆå¥**ï¼šæ¯æ¬¡æ–° session å¿…é ˆç™¼é€ç«‹éˆå¥
- âœ… **ä¸Šä¸‹æ–‡å‰ç¶´**ï¼šçŸ­æ–‡æœ¬ï¼ˆ< 150 å­—ç¬¦ï¼‰æ·»åŠ å‰ç¶´å»ºç«‹èªæ°£
- âœ… **å‘¼å¸ç¬¦è™Ÿ**ï¼šæ–‡æœ¬ä¸­ä½¿ç”¨ "â€¦"ã€"â€”" ç­‰ç¬¦è™Ÿå¢å¼·å‘¼å¸æ„Ÿ

### 4. éŒ¯èª¤è™•ç†

- âœ… **è‡ªå‹•å›é€€**ï¼šå¯¦ç¾ä¸‰å±¤å›é€€æ©Ÿåˆ¶ï¼ˆv3 â†’ multilingual_v2 â†’ turboï¼‰
- âœ… **è¶…æ™‚æ§åˆ¶**ï¼šç‚ºæ¯å€‹æ¨¡å‹è¨­ç½®åˆç†çš„è¶…æ™‚æ™‚é–“
- âœ… **è©³ç´°æ—¥èªŒ**ï¼šè¨˜éŒ„æ¯æ¬¡å˜—è©¦çš„çµæœå’ŒéŒ¯èª¤ä¿¡æ¯
- âœ… **ç”¨æˆ¶å‹å¥½**ï¼šéŒ¯èª¤æ™‚æä¾›å‹å¥½çš„éŒ¯èª¤æç¤º

### 5. æ€§èƒ½å„ªåŒ–

- âœ… **å»¶é²åˆå§‹åŒ–**ï¼šä½¿ç”¨ `getClient()` å»¶é²åˆå§‹åŒ– ElevenLabs å®¢æˆ¶ç«¯
- âœ… **ç’°å¢ƒè®Šé‡æª¢æŸ¥**ï¼šåœ¨åˆå§‹åŒ–å‰æª¢æŸ¥ API Key æ˜¯å¦å­˜åœ¨
- âœ… **ç·©å­˜ç­–ç•¥**ï¼šè€ƒæ…®ç·©å­˜å¸¸ç”¨èªéŸ³çš„ç”Ÿæˆçµæœï¼ˆå¯é¸ï¼‰

---

## ç¨‹å¼ç¢¼æ¶æ§‹

### æ–‡ä»¶çµæ§‹

```
app/lib/
â”œâ”€â”€ elevenlabs-client.ts      # æ ¸å¿ƒ TTS ç”Ÿæˆé‚è¼¯
â”œâ”€â”€ soul/
    â”œâ”€â”€ elevenlabs-adapter.ts  # æƒ…ç·’æ¨™ç±¤ â†’ ElevenLabs åƒæ•¸æ˜ å°„
    â””â”€â”€ elevenlabs-tags.ts     # V3 æ¨™ç±¤å®šç¾©å’Œæ³¨å…¥é‚è¼¯
```

### æ•¸æ“šæµ

```
ç”¨æˆ¶è¼¸å…¥
    â†“
LLM ç”Ÿæˆæ–‡æœ¬ + æƒ…ç·’æ¨™ç±¤
    â†“
elevenlabs-adapter.ts (æ˜ å°„åƒæ•¸ + æ³¨å…¥ V3 æ¨™ç±¤)
    â†“
elevenlabs-client.ts (ç”ŸæˆèªéŸ³ï¼Œå¸¶å›é€€æ©Ÿåˆ¶)
    â†“
è¿”å›éŸ³é » Buffer
```

### é—œéµå‡½æ•¸

#### 1. `generateSpeech(text, emotionTags)`
- **åŠŸèƒ½**ï¼šç”ŸæˆèªéŸ³çš„ä¸»å…¥å£
- **åƒæ•¸**ï¼šæ–‡æœ¬ã€æƒ…ç·’æ¨™ç±¤
- **è¿”å›**ï¼šéŸ³é » Buffer

#### 2. `mapEmotionToElevenLabs(tags, text)`
- **åŠŸèƒ½**ï¼šå°‡æƒ…ç·’æ¨™ç±¤æ˜ å°„ç‚º ElevenLabs åƒæ•¸å’Œ V3 æ¨™ç±¤
- **è¿”å›**ï¼š`ElevenLabsParams` å°è±¡ï¼ˆåŒ…å« `processed_text`ï¼‰

#### 3. `injectV3TagsIntoText(text, emotionTags)`
- **åŠŸèƒ½**ï¼šå°‡ V3 æ¨™ç±¤æ³¨å…¥æ–‡æœ¬
- **è¿”å›**ï¼šæ³¨å…¥æ¨™ç±¤å¾Œçš„æ–‡æœ¬

#### 4. `generateWithFallback(text, params, modelId, config)`
- **åŠŸèƒ½**ï¼šå¸¶å›é€€æ©Ÿåˆ¶çš„èªéŸ³ç”Ÿæˆ
- **è¿”å›**ï¼šéŸ³é » Buffer

#### 5. `truncateTextForModel(text, maxChars)`
- **åŠŸèƒ½**ï¼šæ™ºèƒ½æˆªæ–·æ–‡æœ¬ï¼ˆä¿ç•™ V3 æ¨™ç±¤å’Œå¥å­é‚Šç•Œï¼‰
- **è¿”å›**ï¼šæˆªæ–·å¾Œçš„æ–‡æœ¬

---

## ç’°å¢ƒè®Šé‡é…ç½®

### å¿…éœ€è®Šé‡

```env
# ElevenLabs API Key
ELEVENLABS_API_KEY=your_api_key_here

# Voice IDï¼ˆå¯é¸ï¼Œæœ‰é»˜èªå€¼ï¼‰
ELEVENLABS_VOICE_ID=WUEPpaWdYrRSq7wyeO9O

# Model IDï¼ˆå¯é¸ï¼Œé»˜èªï¼šeleven_multilingual_v2ï¼‰
ELEVENLABS_MODEL_ID=eleven_v3
```

### æ¨è–¦é…ç½®

```env
# é–‹ç™¼ç’°å¢ƒï¼šä½¿ç”¨ multilingual_v2ï¼ˆå¹³è¡¡æ€§èƒ½å’Œè³ªé‡ï¼‰
ELEVENLABS_MODEL_ID=eleven_multilingual_v2

# ç”Ÿç”¢ç’°å¢ƒï¼šä½¿ç”¨ v3ï¼ˆæœ€ä½³æƒ…æ„Ÿè¡¨é”ï¼‰
ELEVENLABS_MODEL_ID=eleven_v3
```

---

## å¸¸è¦‹å•é¡Œï¼ˆFAQï¼‰

### Q1: ç‚ºä»€éº¼è²éŸ³é‚„æ˜¯ã€Œå¹³ã€çš„ï¼Ÿ

**å¯èƒ½åŸå› **ï¼š
1. V3 æ¨™ç±¤æ²’æœ‰æ­£ç¢ºæ³¨å…¥
2. æ–‡æœ¬å¤ªçŸ­ï¼Œæ²’æœ‰å»ºç«‹è¶³å¤ çš„ä¸Šä¸‹æ–‡
3. æƒ…ç·’æ¨™ç±¤æ˜ å°„ä¸æº–ç¢º

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- æª¢æŸ¥æ—¥èªŒç¢ºèª V3 æ¨™ç±¤æ˜¯å¦æ³¨å…¥
- ç‚ºçŸ­æ–‡æœ¬æ·»åŠ ä¸Šä¸‹æ–‡å‰ç¶´
- èª¿æ•´æƒ…ç·’æ¨™ç±¤æ˜ å°„é‚è¼¯

### Q2: å¦‚ä½•è™•ç†è¶…æ™‚ï¼Ÿ

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- å¯¦ç¾è‡ªå‹•å›é€€æ©Ÿåˆ¶
- èª¿æ•´è¶…æ™‚æ™‚é–“ï¼ˆä½†ä¸è¦éé•·ï¼Œå½±éŸ¿ç”¨æˆ¶é«”é©—ï¼‰
- è€ƒæ…®ä½¿ç”¨æ›´å¿«çš„æ¨¡å‹ï¼ˆ`eleven_turbo_v2_5`ï¼‰

### Q3: å­—ç¬¦é™åˆ¶å¦‚ä½•è™•ç†ï¼Ÿ

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- å¯¦ç¾æ™ºèƒ½æˆªæ–·ï¼ˆä¿ç•™ V3 æ¨™ç±¤å’Œå¥å­é‚Šç•Œï¼‰
- è‡ªå‹•åˆ‡æ›åˆ°æ”¯æŒæ›´é•·æ–‡æœ¬çš„æ¨¡å‹
- è€ƒæ…®åˆ†æ®µç”Ÿæˆï¼ˆé©ç”¨æ–¼è¶…é•·æ–‡æœ¬ï¼‰

### Q4: å¦‚ä½•å„ªåŒ–æ€§èƒ½ï¼Ÿ

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨å»¶é²åˆå§‹åŒ–ï¼ˆ`getClient()`ï¼‰
- å¯¦ç¾å›é€€æ©Ÿåˆ¶ï¼ˆé¿å…é‡è©¦å¤±æ•—çš„æ¨¡å‹ï¼‰
- è€ƒæ…®ç·©å­˜å¸¸ç”¨èªéŸ³ï¼ˆå¯é¸ï¼‰

---

## åƒè€ƒè³‡æ–™

- [ElevenLabs API æ–‡æª”](https://elevenlabs.io/docs)
- [ElevenLabs V3 æ¨¡å‹èªªæ˜](https://elevenlabs.io/docs/api-reference/text-to-speech)
- [å°è»ŸæŠ€è¡“æŒ‡å¼•](./XIAORUAN_TECH_GUIDE.md)

---

## æ›´æ–°æ—¥èªŒ

### v1.0 (2024)
- âœ… åˆå§‹ç‰ˆæœ¬
- âœ… å®Œæ•´çš„ V3 æ¨™ç±¤ç³»çµ±
- âœ… ä¸‰å±¤å›é€€æ©Ÿåˆ¶
- âœ… æ™ºèƒ½æˆªæ–·ç­–ç•¥
- âœ… è©³ç´°çš„éŒ¯èª¤è™•ç†

---

**æœ€å¾Œæ›´æ–°**: 2024  
**ç¶­è­·è€…**: Cè¬€  
**ç‰ˆæœ¬**: 1.0

